# =============================================================================
# Geopolitical Intelligence Platform - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control
# =============================================================================

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/geoint
# Optional: override sync URL used by Alembic (auto-derived if empty)
DATABASE_URL_SYNC=
POSTGRES_USER=geoint
POSTGRES_PASSWORD=change-me
POSTGRES_DB=geoint

# Connection pool settings
DATABASE_POOL_SIZE=5
DATABASE_MAX_OVERFLOW=10

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379/0

# -----------------------------------------------------------------------------
# API Configuration
# -----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=true
ENVIRONMENT=development

# CORS origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080
API_AUTH_ENABLED=false
API_KEY=
API_KEY_FILE=
API_KEYS=
API_KEYS_FILE=
API_ADMIN_KEY=
API_ADMIN_KEY_FILE=
API_RATE_LIMIT_PER_MINUTE=120
API_RATE_LIMIT_WINDOW_SECONDS=60
API_RATE_LIMIT_REDIS_PREFIX=horadus:api_rate_limit
API_KEYS_PERSIST_PATH=

# -----------------------------------------------------------------------------
# LLM Configuration (Required)
# -----------------------------------------------------------------------------
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-key-here
OPENAI_API_KEY_FILE=
LLM_PRIMARY_PROVIDER=openai
LLM_PRIMARY_BASE_URL=
# Recommended Tier-2 failover provider (OpenAI-compatible):
# LLM_SECONDARY_PROVIDER=deepseek
# LLM_SECONDARY_BASE_URL=https://api.deepseek.com
LLM_SECONDARY_PROVIDER=
LLM_SECONDARY_BASE_URL=
LLM_SECONDARY_API_KEY=
LLM_SECONDARY_API_KEY_FILE=
LLM_TIER1_MODEL=gpt-4.1-nano
LLM_TIER1_SECONDARY_MODEL=
LLM_TIER2_MODEL=gpt-4.1-mini
# Recommended Tier-2 failover model (DeepSeek V3.2 family; update if provider publishes newer ID):
# LLM_TIER2_SECONDARY_MODEL=deepseek-chat
LLM_TIER2_SECONDARY_MODEL=
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSIONS=1536
EMBEDDING_BATCH_SIZE=32
EMBEDDING_CACHE_MAX_SIZE=2048
LLM_TIER1_BATCH_SIZE=10
LLM_REPORT_MODEL=gpt-4.1-mini
LLM_RETROSPECTIVE_MODEL=gpt-4.1-mini

# -----------------------------------------------------------------------------
# Telegram Configuration (Optional)
# -----------------------------------------------------------------------------
# Get these from: https://my.telegram.org/apps
TELEGRAM_API_ID=
TELEGRAM_API_HASH=
TELEGRAM_SESSION_NAME=geoint_session

# -----------------------------------------------------------------------------
# GDELT Configuration (Optional)
# -----------------------------------------------------------------------------
# GDELT is free, no API key required for basic usage
# Set this if you have a premium account
GDELT_API_KEY=

# -----------------------------------------------------------------------------
# Celery Configuration
# -----------------------------------------------------------------------------
# Use same Redis URL as above, different database
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO
# Use 'json' for production and 'console' for development.
LOG_FORMAT=json
SQL_ECHO=false

# -----------------------------------------------------------------------------
# File-based Secrets (Production Recommended)
# -----------------------------------------------------------------------------
# Any *_FILE value points to a file whose contents replace the corresponding variable.
# Example:
# OPENAI_API_KEY_FILE=/run/secrets/openai_api_key
# DATABASE_URL_FILE=/run/secrets/database_url
# CELERY_BROKER_URL_FILE=/run/secrets/celery_broker_url

DATABASE_URL_FILE=
DATABASE_URL_SYNC_FILE=
REDIS_URL_FILE=
SECRET_KEY_FILE=
CELERY_BROKER_URL_FILE=
CELERY_RESULT_BACKEND_FILE=

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
ENABLE_TELEGRAM_INGESTION=false
ENABLE_GDELT_INGESTION=true
ENABLE_RSS_INGESTION=true
ENABLE_PROCESSING_PIPELINE=true

# -----------------------------------------------------------------------------
# Processing Configuration
# -----------------------------------------------------------------------------
PROCESSING_PIPELINE_BATCH_SIZE=50
PROCESSING_STALE_TIMEOUT_MINUTES=30
PROCESSING_REAPER_INTERVAL_MINUTES=15
TREND_SNAPSHOT_INTERVAL_MINUTES=60

# -----------------------------------------------------------------------------
# Reporting Schedule (UTC)
# -----------------------------------------------------------------------------
WEEKLY_REPORT_DAY_OF_WEEK=1
WEEKLY_REPORT_HOUR_UTC=7
WEEKLY_REPORT_MINUTE_UTC=0
MONTHLY_REPORT_DAY_OF_MONTH=1
MONTHLY_REPORT_HOUR_UTC=8
MONTHLY_REPORT_MINUTE_UTC=0

# -----------------------------------------------------------------------------
# Backup Operations
# -----------------------------------------------------------------------------
BACKUP_RETENTION_DAYS=14
BACKUP_RETENTION_COUNT=30
VERIFY_BACKUP=true
MIN_BACKUP_BYTES=1024
MAX_BACKUP_AGE_HOURS=30

# -----------------------------------------------------------------------------
# Calibration Drift Alerting
# -----------------------------------------------------------------------------
CALIBRATION_DRIFT_MIN_RESOLVED_OUTCOMES=20
CALIBRATION_DRIFT_BRIER_WARN_THRESHOLD=0.20
CALIBRATION_DRIFT_BRIER_CRITICAL_THRESHOLD=0.30
CALIBRATION_DRIFT_BUCKET_ERROR_WARN_THRESHOLD=0.15
CALIBRATION_DRIFT_BUCKET_ERROR_CRITICAL_THRESHOLD=0.25
CALIBRATION_DRIFT_WEBHOOK_URL=
CALIBRATION_DRIFT_WEBHOOK_TIMEOUT_SECONDS=5.0
CALIBRATION_DRIFT_WEBHOOK_MAX_RETRIES=3
CALIBRATION_DRIFT_WEBHOOK_BACKOFF_SECONDS=1.0
CALIBRATION_COVERAGE_MIN_RESOLVED_PER_TREND=5
CALIBRATION_COVERAGE_MIN_RESOLVED_RATIO=0.50

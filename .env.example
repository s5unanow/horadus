# =============================================================================
# Geopolitical Intelligence Platform - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control
# =============================================================================

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/geoint
# Optional: override sync URL used by Alembic (auto-derived if empty)
DATABASE_URL_SYNC=
POSTGRES_USER=geoint
POSTGRES_PASSWORD=change-me
POSTGRES_DB=geoint

# Connection pool settings
DATABASE_POOL_SIZE=5
DATABASE_MAX_OVERFLOW=10
DATABASE_POOL_TIMEOUT_SECONDS=30
MIGRATION_PARITY_CHECK_ENABLED=true
MIGRATION_PARITY_STRICT_STARTUP=false
# Migration drift gate strict mode (used by scripts/check_migration_drift.sh + Make targets)
MIGRATION_GATE_VALIDATE_AUTOGEN=true
INTEGRATION_DB_TRUNCATE_ALLOWED=false
INTEGRATION_DB_TRUNCATE_ALLOW_REMOTE=false

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379/0

# -----------------------------------------------------------------------------
# API Configuration
# -----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=true
ENVIRONMENT=development
# Public hostname used by production HTTPS ingress (Caddy).
HORADUS_PUBLIC_DOMAIN=localhost
# ACME registration email for certificate issuance/renewal.
CADDY_ACME_EMAIL=admin@localhost
# Optional ACME directory override (defaults to Let's Encrypt production).
CADDY_ACME_CA=

# CORS origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080
# Production guardrail: must be true when ENVIRONMENT=production.
API_AUTH_ENABLED=false
API_KEY=
API_KEY_FILE=
API_KEYS=
API_KEYS_FILE=
# Production guardrail: required for key-management endpoints.
API_ADMIN_KEY=
API_ADMIN_KEY_FILE=
API_RATE_LIMIT_PER_MINUTE=120
API_RATE_LIMIT_WINDOW_SECONDS=60
API_RATE_LIMIT_STRATEGY=fixed_window
API_RATE_LIMIT_REDIS_PREFIX=horadus:api_rate_limit
API_KEYS_PERSIST_PATH=

# -----------------------------------------------------------------------------
# LLM Configuration (Required)
# -----------------------------------------------------------------------------
# Get your API key from: https://platform.openai.com/api-keys
# Production: keep this empty and set OPENAI_API_KEY_FILE instead.
OPENAI_API_KEY=
OPENAI_API_KEY_FILE=
LLM_PRIMARY_PROVIDER=openai
LLM_PRIMARY_BASE_URL=
# Recommended Tier-2 failover provider (OpenAI-compatible):
# LLM_SECONDARY_PROVIDER=deepseek
# LLM_SECONDARY_BASE_URL=https://api.deepseek.com
LLM_SECONDARY_PROVIDER=
LLM_SECONDARY_BASE_URL=
LLM_SECONDARY_API_KEY=
LLM_SECONDARY_API_KEY_FILE=
LLM_TIER1_MODEL=gpt-4.1-nano
LLM_TIER1_SECONDARY_MODEL=
LLM_TIER2_MODEL=gpt-4.1-mini
# Recommended Tier-2 failover model (DeepSeek V3.2 family; update if provider publishes newer ID):
# LLM_TIER2_SECONDARY_MODEL=deepseek-chat
LLM_TIER2_SECONDARY_MODEL=
EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSIONS=1536
EMBEDDING_BATCH_SIZE=32
EMBEDDING_CACHE_MAX_SIZE=2048
EMBEDDING_MAX_INPUT_TOKENS=8191
EMBEDDING_INPUT_POLICY=truncate
EMBEDDING_TOKEN_ESTIMATE_CHARS_PER_TOKEN=4
VECTOR_REVALIDATION_CADENCE_DAYS=30
VECTOR_REVALIDATION_DATASET_GROWTH_PCT=20
LLM_TIER1_BATCH_SIZE=10
LLM_ROUTE_RETRY_ATTEMPTS=2
LLM_ROUTE_RETRY_BACKOFF_SECONDS=0.25
LLM_SEMANTIC_CACHE_ENABLED=false
LLM_SEMANTIC_CACHE_TTL_SECONDS=21600
LLM_SEMANTIC_CACHE_MAX_ENTRIES=10000
LLM_SEMANTIC_CACHE_REDIS_PREFIX=horadus:llm_semantic_cache
LLM_REPORT_MODEL=gpt-4.1-mini
LLM_REPORT_API_MODE=chat_completions
NARRATIVE_GROUNDING_MAX_UNSUPPORTED_CLAIMS=0
NARRATIVE_GROUNDING_NUMERIC_TOLERANCE=0.05
LLM_RETROSPECTIVE_MODEL=gpt-4.1-mini

# -----------------------------------------------------------------------------
# Telegram Configuration (Optional)
# -----------------------------------------------------------------------------
# Get these from: https://my.telegram.org/apps
TELEGRAM_API_ID=
TELEGRAM_API_HASH=
TELEGRAM_SESSION_NAME=geoint_session

# -----------------------------------------------------------------------------
# GDELT Configuration (Optional)
# -----------------------------------------------------------------------------
# GDELT is free, no API key required for basic usage
# Set this if you have a premium account
GDELT_API_KEY=

# -----------------------------------------------------------------------------
# Celery Configuration
# -----------------------------------------------------------------------------
# Use same Redis URL as above, different database
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
WORKER_HEARTBEAT_REDIS_KEY=horadus:worker:last_activity
WORKER_HEARTBEAT_STALE_SECONDS=900
WORKER_HEARTBEAT_TTL_SECONDS=3600

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO
# Use 'json' for production and 'console' for development.
LOG_FORMAT=json
SQL_ECHO=false

# -----------------------------------------------------------------------------
# OpenTelemetry Tracing (Optional)
# -----------------------------------------------------------------------------
OTEL_ENABLED=false
OTEL_SERVICE_NAME=horadus-backend
OTEL_SERVICE_NAMESPACE=horadus
OTEL_TRACES_SAMPLER_RATIO=1.0
# Example: http://localhost:4318/v1/traces (Jaeger/OTel Collector OTLP HTTP)
OTEL_EXPORTER_OTLP_ENDPOINT=
# Optional comma-separated header list, e.g. Authorization=Bearer token,x-tenant=acme
OTEL_EXPORTER_OTLP_HEADERS=

# -----------------------------------------------------------------------------
# File-based Secrets (Production Recommended)
# -----------------------------------------------------------------------------
# Any *_FILE value points to a file whose contents replace the corresponding variable.
# In production, prefer *_FILE and avoid putting raw secret values in this file.
# Example:
# OPENAI_API_KEY_FILE=/run/secrets/openai_api_key
# DATABASE_URL_FILE=/run/secrets/database_url
# CELERY_BROKER_URL_FILE=/run/secrets/celery_broker_url

DATABASE_URL_FILE=
DATABASE_URL_SYNC_FILE=
REDIS_URL_FILE=
# Production guardrail: set SECRET_KEY or SECRET_KEY_FILE explicitly.
# If SECRET_KEY is set directly, use >=32 chars and avoid weak values.
SECRET_KEY_FILE=
CELERY_BROKER_URL_FILE=
CELERY_RESULT_BACKEND_FILE=

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
ENABLE_TELEGRAM_INGESTION=false
ENABLE_GDELT_INGESTION=true
ENABLE_RSS_INGESTION=true
ENABLE_PROCESSING_PIPELINE=true

# -----------------------------------------------------------------------------
# Processing Configuration
# -----------------------------------------------------------------------------
PROCESSING_PIPELINE_BATCH_SIZE=200
PROCESSING_STALE_TIMEOUT_MINUTES=30
PROCESSING_REAPER_INTERVAL_MINUTES=15
RETENTION_CLEANUP_ENABLED=false
RETENTION_CLEANUP_INTERVAL_HOURS=24
RETENTION_CLEANUP_DRY_RUN=true
RETENTION_CLEANUP_BATCH_SIZE=500
RETENTION_RAW_ITEM_NOISE_DAYS=30
RETENTION_RAW_ITEM_ARCHIVED_EVENT_DAYS=90
RETENTION_EVENT_ARCHIVED_DAYS=180
RETENTION_TREND_EVIDENCE_DAYS=365
PROCESS_PENDING_INTERVAL_MINUTES=15
PROCESSING_DISPATCH_MAX_IN_FLIGHT=1
PROCESSING_DISPATCH_LOCK_TTL_SECONDS=30
PROCESSING_DISPATCH_MIN_BUDGET_HEADROOM_PCT=10
PROCESSING_DISPATCH_LOW_HEADROOM_LIMIT=50
LANGUAGE_POLICY_SUPPORTED_LANGUAGES=en,uk,ru
LANGUAGE_POLICY_UNSUPPORTED_MODE=skip
TREND_SNAPSHOT_INTERVAL_MINUTES=60
RSS_COLLECTION_INTERVAL=360
GDELT_COLLECTION_INTERVAL=360
INGESTION_WINDOW_OVERLAP_SECONDS=300
SOURCE_FRESHNESS_ALERT_MULTIPLIER=2.0
SOURCE_FRESHNESS_CHECK_INTERVAL_MINUTES=30
SOURCE_FRESHNESS_MAX_CATCHUP_DISPATCHES=2
RSS_COLLECTOR_TOTAL_TIMEOUT_SECONDS=300
GDELT_COLLECTOR_TOTAL_TIMEOUT_SECONDS=300
COLLECTOR_TASK_MAX_RETRIES=3
COLLECTOR_RETRY_BACKOFF_MAX_SECONDS=300

# -----------------------------------------------------------------------------
# Reporting Schedule (UTC)
# -----------------------------------------------------------------------------
WEEKLY_REPORT_DAY_OF_WEEK=1
WEEKLY_REPORT_HOUR_UTC=7
WEEKLY_REPORT_MINUTE_UTC=0
MONTHLY_REPORT_DAY_OF_MONTH=1
MONTHLY_REPORT_HOUR_UTC=8
MONTHLY_REPORT_MINUTE_UTC=0

# -----------------------------------------------------------------------------
# Backup Operations
# -----------------------------------------------------------------------------
BACKUP_RETENTION_DAYS=14
BACKUP_RETENTION_COUNT=30
VERIFY_BACKUP=true
MIN_BACKUP_BYTES=1024
MAX_BACKUP_AGE_HOURS=30

# -----------------------------------------------------------------------------
# Calibration Drift Alerting
# -----------------------------------------------------------------------------
CALIBRATION_DRIFT_MIN_RESOLVED_OUTCOMES=20
CALIBRATION_DRIFT_BRIER_WARN_THRESHOLD=0.20
CALIBRATION_DRIFT_BRIER_CRITICAL_THRESHOLD=0.30
CALIBRATION_DRIFT_BUCKET_ERROR_WARN_THRESHOLD=0.15
CALIBRATION_DRIFT_BUCKET_ERROR_CRITICAL_THRESHOLD=0.25
CALIBRATION_DRIFT_WEBHOOK_URL=
CALIBRATION_DRIFT_WEBHOOK_TIMEOUT_SECONDS=5.0
CALIBRATION_DRIFT_WEBHOOK_MAX_RETRIES=3
CALIBRATION_DRIFT_WEBHOOK_BACKOFF_SECONDS=1.0
CALIBRATION_COVERAGE_MIN_RESOLVED_PER_TREND=5
CALIBRATION_COVERAGE_MIN_RESOLVED_RATIO=0.50
